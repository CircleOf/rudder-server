FROM frolvlad/alpine-glibc:alpine-3.15_glibc-2.34
RUN apk add --no-cache ca-certificates postgresql-client curl bash
RUN apk upgrade
ADD rudder-server /
ADD rudder-server-with-race /
ADD ./rudder-cli/rudder-cli.linux.x86_64 /usr/bin/rudder-cli
ADD build/regulation-worker /
ADD build/wait-for /
ADD build/wait-for-go/wait-for-go /
ADD build/docker-entrypoint.sh /

ADD services/filemanager/load-test/staging.json.gz /services/filemanager/load-test/staging.json.gz
ADD services/filemanager/load-test/demo-track-load-objects.csv.gz /services/filemanager/load-test/demo-track-load-objects.csv.gz
ADD services/filemanager/load-test/tracks-load-objects.csv.gz /services/filemanager/load-test/tracks-load-objects.csv.gz

COPY scripts/generate-event /scripts
COPY scripts/batch.json /scripts
ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["/rudder-server-with-race"]
